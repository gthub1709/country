<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ö–∞—Ä—Ç–∞ —Å –æ–±–Ω–æ–≤–ª—è–µ–º—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –∏–∫–æ–Ω–∫–∞–º–∏</title>

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet/dist/leaflet.css"
/>
<!-- Leaflet Control Geocoder CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"
/>

<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  #map {
    width: 100%; height: 100%;
    transition: background-color 0.5s ease;
  }
  #theme-toggle {
    position: absolute;
    top: 10px; right: 10px;
    z-index: 1200;
    background: white;
    border-radius: 6px;
    border: 1.5px solid #666;
    padding: 8px 14px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 0 6px rgba(0,0,0,0.15);
    user-select: none;
    transition: background-color 0.3s ease;
  }
  #theme-toggle:hover {
    background-color: #f0f0f0;
  }
  .leaflet-marker-icon.user-marker {
    animation: pulse 2s infinite;
    filter: drop-shadow(0 0 3px #00f);
  }
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.3); }
  }

  /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ø–∞–ø–æ–≤ */
  .leaflet-popup-content-wrapper {
    background: linear-gradient(135deg, #4a90e2, #357ABD);
    color: white;
    font-size: 14px;
    border-radius: 10px;
    box-shadow: 0 0 8px rgba(53, 122, 189, 0.8);
  }
  .leaflet-popup-tip {
    background: linear-gradient(135deg, #4a90e2, #357ABD);
  }

</style>
</head>
<body>

<div id="map"></div>
<div id="theme-toggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<!-- Leaflet Control Geocoder JS -->
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

<script>
  let isDark = true;

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
  const map = L.map('map').setView([20, 0], 2);

  const lightTiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors',
    maxZoom: 19,
  });

  const darkTiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap, CartoDB',
    maxZoom: 19,
    subdomains: 'abcd'
  });

  darkTiles.addTo(map);

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
  const themeToggleBtn = document.getElementById('theme-toggle');
  themeToggleBtn.onclick = () => {
    if (isDark) {
      map.removeLayer(darkTiles);
      map.addLayer(lightTiles);
      themeToggleBtn.textContent = '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
    } else {
      map.removeLayer(lightTiles);
      map.addLayer(darkTiles);
      themeToggleBtn.textContent = '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
    }
    isDark = !isDark;
  };

  // –ü–æ–∏—Å–∫ —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
  L.Control.geocoder({
    defaultMarkGeocode: false,
    placeholder: '–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞...',
  })
  .on('markgeocode', function(e) {
    const bbox = e.geocode.bbox;
    const poly = L.polygon([
      bbox.getSouthEast(),
      bbox.getNorthEast(),
      bbox.getNorthWest(),
      bbox.getSouthWest()
    ]).addTo(map);
    map.fitBounds(poly.getBounds());
    setTimeout(() => map.removeLayer(poly), 3000);
  })
  .addTo(map);

  // –ì–æ—Ä–æ–¥–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∏ —Ç–∞–π–º–∑–æ–Ω–∞–º–∏
  const cities = [
    { name: '–õ–æ–Ω–¥–æ–Ω', coords: [51.5074, -0.1278], timezone: 'Europe/London' },
    { name: '–ù—å—é-–ô–æ—Ä–∫', coords: [40.7128, -74.006], timezone: 'America/New_York' },
    { name: '–¢–æ–∫–∏–æ', coords: [35.6895, 139.6917], timezone: 'Asia/Tokyo' },
    { name: '–ú–æ—Å–∫–≤–∞', coords: [55.7558, 37.6176], timezone: 'Europe/Moscow' },
    { name: '–°–∏–¥–Ω–µ–π', coords: [-33.8688, 151.2093], timezone: 'Australia/Sydney' }
  ];

  // SVG –∏–∫–æ–Ω–∫–∏ –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤
  const cityIconSvg = `
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="37" viewBox="0 0 32 37" fill="none" stroke="#357ABD" stroke-width="2" stroke-linejoin="round" stroke-linecap="round">
      <path d="M16 1C9 10 2 18 16 36C30 18 23 10 16 1Z" fill="#4a90e2"/>
      <circle cx="16" cy="16" r="6" fill="white"/>
    </svg>
  `;

  // –°–æ–∑–¥–∞–¥–∏–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏–∫–æ–Ω–∫–∏
  function createCityIcon() {
    return L.divIcon({
      html: cityIconSvg,
      className: '',
      iconSize: [32, 37],
      iconAnchor: [16, 37],
      popupAnchor: [0, -37],
    });
  }

  // –ú–µ—Ç–∫–∏ –≥–æ—Ä–æ–¥–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
  let cityMarkers = [];

  async function updateCityTimes() {
    for (const markerData of cityMarkers) {
      try {
        const res = await fetch(`https://worldtimeapi.org/api/timezone/${markerData.timezone}`);
        const data = await res.json();
        const localTime = new Date(data.datetime).toLocaleTimeString();
        markerData.marker.setPopupContent(`<b>${markerData.name}</b><br>–ú–µ—Å—Ç–Ω–æ–µ –≤—Ä–µ–º—è: ${localTime}`);
      } catch {
        markerData.marker.setPopupContent(`<b>${markerData.name}</b><br>–ú–µ—Å—Ç–Ω–æ–µ –≤—Ä–µ–º—è: –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å`);
      }
    }
  }

  function addCityMarkers() {
    cities.forEach(city => {
      const marker = L.marker(city.coords, { icon: createCityIcon() }).addTo(map);
      cityMarkers.push({ name: city.name, timezone: city.timezone, marker });
      marker.bindPopup(`<b>${city.name}</b><br>–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–∏...`);
      // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
      marker.on('mouseover', () => marker.openPopup());
      marker.on('mouseout', () => marker.closePopup());
    });
  }

  addCityMarkers();
  updateCityTimes();

  // –û–±–Ω–æ–≤–ª—è—Ç—å –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
  setInterval(updateCityTimes, 60000);

  // –ö–∞—Å—Ç–æ–º–Ω–∞—è –∏–∫–æ–Ω–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (SVG)
  const userIconSvg = `
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="37" viewBox="0 0 32 37" fill="none" stroke="#00aaff" stroke-width="2" stroke-linejoin="round" stroke-linecap="round">
      <circle cx="16" cy="11" r="7" fill="#00cfff" />
      <path d="M2 36c0-8 28-8 28 0v-6c0-7-28-7-28 0v6z" fill="#00aaff" />
    </svg>
  `;

  const userIcon = L.divIcon({
    html: userIconSvg,
    className: 'user-marker',
    iconSize: [32, 37],
    iconAnchor: [16, 37],
    popupAnchor: [0, -37],
  });

  // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  map.locate({ setView: true, maxZoom: 10 });
  map.on('locationfound', e => {
    L.circle(e.latlng, { radius: e.accuracy, color: '#0088ff', weight: 2, fillColor: '#00aaff', fillOpacity: 0.3 }).addTo(map);
    L.marker(e.latlng, { icon: userIcon })
      .addTo(map)
      .bindPopup('–≠—Ç–æ —Ç—ã! üë§<br>–ü—Ä–∏–≤–µ—Ç –æ—Ç ChatGPT üòâ')
      .openPopup();
  });
  map.on('locationerror', () => {
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.');
  });
</script>

</body>
</html>

